* Additional modifications for the HB63C09 by Dave Collins, Z80Dad
; VERSION 3.7
; 2024-0331:	DC	REMOVED OPTION ROM BUILDING FROM CODE FOR TINYBASIC, AND FORTH DUE TO 
;			SIZE CONSTRAINTS (IT IS TRIVIAL TO UNCOMMENT THEM)
;		DC	CHANGED ADDRESS RANGES TO SUPPORT THE HB63C09
;		DC	FIXED 'WRAP AROUND' BUG FROM ORIGINAL DUNFIELD SOURCE WHICH WOULD CAUSE
;			MEMORY SR TO OUTPUT FOREVER IF YOU TRIED TO DISPLAY AN ADDRESS
;			FROM 0xFFF0 TO THE END OF MEMORY.  THIS SLIGHTLY CHANGES THE BEHAVIOR, 
;			AS NOW, THE START ADDRESS WILL ALIGN WITH THE BEGINNING OF A 16 BYTE
;			BLOCK (STARTING AT A NUMBER WITH THE BOTTOM 4 BITS BEING CLEAR.)
;			SINCE THE SR ALWAYS OUTPUTS 16 BYTES THIS ALIGNS THE LAST INCREMENT OF X 
; 			WITH ZERO SO THAT WE CAN CATCH THE REGISTER ROLLING OVER AND THE SR 
;			DOES NOT RUN FOREVER.  ITS ARGUABLE THIS IS THE CORRECT FUNCTIONALITY
;			OF THE DISPLAY MEMORY SR AS IT ALWAYS OUTPUTS 16 BYTES REGARDLESS OF 
;			THE LAST ADDRESS IN THE RANGE.
;		DC	FOUND AN ISSUE WITH LOAD SR WITH THE SRECORD FORMAT.  THE SUBROTINE NEEDED 
;			TO IGNORE RECORD TYPE 5 - COUNT. SINCE IT IS A 16 BIT ADDRESS BUS. THE OTHER
;			COUNT RECORD TYPES WONT NEED TO BE TESTED FOR. (FIXED)
;		DC	FIXED CRLF HANDLER MOSTLY. OCCASIONALLY IT WILL DUMP A SPURIOUS CR ONTO THE 
;			PROMPT THIS DEPENDS ON HOW THE FILE WAS TERMINATED BY THE COMPLIER. RECORD 
;			TYPE 9 IGNORES ANY START ADDRESS THAT IS PLACED THERE, THIS WAS ALWAYS THE 
;			CASE HOWEVER NOW IT READS THE CHARACTERS IN UNTIL THE END OF THE LINE.
;		DC	SWITCHED BASIC ROM TO A MODIFIED DIGICOOLTHINGS ROM, SEE BASIC ROM SOURCE
;			FOR DETAILS.
; 
;* Additional modifications for the 6809SBC by Johnny Quest.
;*
;******************************************************************************
; VERSION 3.6
; 2021-0904:	JQ	ON ILLOP/DIV INTERRUPT, CORRECTED BUG WHERE THE HANDLER
;					 JUMPS TO THE BREAKPOINT DISPLAY TO EXIT BUT THE 'BRKREG'
;					 IS LOCATED WITHIN THE BREAKPOINT ROUTINE, WHICH CAUSES
;					 CONFUSIION AND EVENTUAL HANG.
;				JQ	SEEMS THAT DETECTION OF A 6309 AND SETTING IT TO 'NATIVE'
;					 MODE CAUSES PROBLEMS, SO THE MODE REGISTER IS NOT TOUCHED
;					 AND THE HD6309 IS LEFT IN 'EMULATION MODE'.
;				JQ	CORRECTED BUG IN 'CHGREG' WHERE CHANGING REGISTER 'D' WAS NOT
;					 RECOGNIZED AS A 16-BIT REGISTER.
;******************************************************************************
; VERSION 3.5
; 2021-0824:	JQ	ON ILLOP/DIV INTERRUPT, INFORMS WHICH ONE CAUSED IT.
;				JQ	IF 6309 IS DETECTED, THE MODE REGISTER IS SET TO 'NATIVE'.
; 2021-0823:	JQ	ADDED SUPPORT FOR DETECTING IF THE HOST MCU IS AN MC6809
;					 OR AN HD6309 AND EMITS THE PROPER SIGN-ON MESSAGE.
;				JQ	ADDED A BUILD DATE AND TIME TO THE SIGN-ON MESSAGE. THE
;					 LINUX "build.sh" SCRIPT CREATES A SEPARATE ASSEMBLY FILE
;					 THAT IS "INCLUDED" IN THE MAIN ASSEMBLY FILE.
;				JQ	BE AWARE THAT THE DISASSEMBLER DOES NOT YET SUPPORT THE
;					 6309 EXTENDED INSTRUCTIONS.
; 2021-0419:	JQ	ADDED SUPPORT FOR MERGING THE BINARY IMAGES OF THE
;					 LANGUAGE SUPPORT MODULES DIRECTLY INTO THE MON09
;					 IMAGE FILE. USE CONDITIONAL ASSEMBLY TO ENABLE/DISABLE.
;					 CONSTRUCTED MASTER BUILD SCRIPT TO ASSEMBLE THE VARIOUS
;					 LANGUAGE MODULES INTO A MASTER FIRMWARE IMAGE FILE. THUS,
;					 INCLUDING THEM INTO THE MON09 IMAGE AS DATA STATEMENTS
;					 IS UNNESSESARY.
; 2021-0412:	JQ	CHANGED THE MANNER IN WHICH NMI IS HANDLED SO THAT THE
;					 VECTOR CAN BE SET IN MEMORY JUST AS THE FIRQ, IRQ, SWI2
;					 AND SWI3 HANDLERS DO. IF AN NMI VECTOR IS NOT SPECIFIED,
;					 MON09 DEFAULTS TO THE INTERNAL NMI HANDLER, WHICH IS SHOWN
;					 BY THE 'DV' COMMAND. ADDED ADDITIONAL BYTES TO THE DATA
;					 TABLES AND AN NMI HANDLER. USE CONDITIONAL STATEMENT TO
;					 ENABLE IT.
;				JQ	ADDED HD6309 ILLOP INSTRUCTION HANDLER. IF NO VECTOR
;					 SPECIFIED, DEFAULTS TO THE MON09 ILLOP HANDLER. USE
;					 CONDITIONAL STATEMENT TO ENABLE IT.
;				JQ	ADDED 'JUMP' COMMAND TO ACCESS THE FP BASIC, TINY BASIC
;					 AND FORTH MODULES IN ROM. USE CONDITIONAL STATEMENT TO
;					 ENABLE IT.
;				JQ	ADDED JUMP TABLE OF 'HOOKS' THAT PROVIDES A SUMMARY OF
;					 USER ACCESSIBLE MON09 ROM ENTRY ADDRESSES AND IRQ RE-
;					 VECTORING ADDRESSES IN DATA RAM. IT IS INTENDED TO BE
;					 EASILY IDENTIFIED AND EXTRACTED FROM THE SYMBOL TABLE
;					 TO BE 'INCLUDED' IN THE USER'S PROGRAM FILE. SINCE THE
;					 TABLE IS LOCATED AT
;				JQ	IN 'FILMEM' ROUTINE, ADDED CODE TO LIMIT THE USER
;					 SPECIFIED ENDING ADDRESS SO AS NOT TO OVERWRITE MON09
;					 DATA IN RAM. THIS EFFECTIVELY LIMITS THE 'FM' COMMAND
;					 TO RAM ONLY ON THE 6809SBC.
;
;******************************************************************************
; VERSION 3.4
; 2021-0404:	JQ	MODIFIED FOR USE WITH 6809SBC PROJECT USING 6850 ACIA.
;					 ASSEMBLES WITH LWASM V4.18, WHICH SUPPORTS MACROS AND
;					 CONDITIONAL ASSEMBLY STATEMENTS.
;
;******************************************************************************
;MODS BY JQ